<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SF & Yosemite Trip Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', 'Noto Sans KR', sans-serif; }
        
        /* Map Customization */
        #map { height: 100%; width: 100%; z-index: 0; }
        .leaflet-popup-content-wrapper { border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); padding: 0; }
        .leaflet-popup-content { margin: 0; }
        
        /* Custom Marker Styles */
        .marker-pin {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            border: 3px solid;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 8px rgba(0,0,0,0.3);
            font-weight: 700;
            font-size: 14px;
            position: relative;
            transition: transform 0.2s;
        }
        .marker-pin:hover { transform: scale(1.1); z-index: 100 !important; }
        .marker-number { color: #333; }

        /* Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* UI Animations */
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .active-day-btn { background-color: #2563EB; color: white; border-color: #2563EB; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3); }
        .inactive-day-btn { background-color: white; color: #4B5563; border-color: #E5E7EB; }
        .inactive-day-btn:hover { background-color: #F3F4F6; }

        /* Modals */
        .modal-overlay { 
            display: none; 
            position: fixed; 
            top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.5); 
            z-index: 5000; 
            align-items: center; 
            justify-content: center;
            backdrop-filter: blur(4px);
        }
        .modal-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            max-width: 400px;
            width: 90%;
            position: relative;
        }
    </style>
</head>
<body class="bg-gray-50 h-screen flex flex-col lg:flex-row overflow-hidden text-gray-800">

    <!-- Flight Modal -->
    <div id="flight-modal" class="modal-overlay" onclick="toggleModal('flight-modal')">
        <div class="modal-card fade-in" onclick="event.stopPropagation()">
            <div class="bg-blue-600 p-6 text-white text-center relative">
                <h3 class="text-lg font-bold tracking-widest uppercase">Boarding Pass</h3>
                <p class="text-xs opacity-80 mt-1">Air Premia (YP)</p>
                <button onclick="toggleModal('flight-modal')" class="absolute top-4 right-4 text-white/80 hover:text-white">
                    <i class="ph-bold ph-x text-xl"></i>
                </button>
            </div>
            
            <!-- Outbound -->
            <div class="p-6 pb-2 bg-white">
                <div class="flex justify-between items-center text-xs text-gray-400 mb-1 font-bold tracking-wide">
                    <span>OUTBOUND</span>
                    <span>2026. 4. 29 (Ïàò)</span>
                </div>
                <div class="flex justify-between items-center mb-4">
                    <div class="text-center">
                        <span class="block text-3xl font-black text-gray-800">ICN</span>
                        <span class="text-xs text-gray-500">Seoul</span>
                    </div>
                    <div class="flex-1 px-4 flex flex-col items-center">
                        <i class="ph-fill ph-airplane-tilt text-blue-500 text-xl"></i>
                        <span class="text-xs font-bold text-blue-600 mt-1">YP111</span>
                        <div class="w-full h-px bg-gray-200 mt-1"></div>
                        <span class="text-[10px] text-gray-400 mt-1">~10h 40m</span>
                    </div>
                    <div class="text-center">
                        <span class="block text-3xl font-black text-gray-800">SFO</span>
                        <span class="text-xs text-gray-500">San Francisco</span>
                    </div>
                </div>
                <div class="flex justify-between text-sm">
                    <div><span class="block text-gray-400 text-xs">Depart</span><span class="font-bold text-gray-800">18:20</span></div>
                     <div class="text-right"><span class="block text-gray-400 text-xs">Arrive</span><span class="font-bold text-gray-800">13:00</span></div>
                </div>
            </div>

            <div class="relative h-6 w-full bg-white overflow-hidden">
                 <div class="absolute w-full border-t-2 border-dashed border-gray-300 top-3"></div>
                 <div class="absolute w-6 h-6 bg-gray-800 rounded-full -left-3 top-0" style="background-color: rgba(0,0,0,0.5)"></div>
                 <div class="absolute w-6 h-6 bg-gray-800 rounded-full -right-3 top-0" style="background-color: rgba(0,0,0,0.5)"></div>
            </div>

            <!-- Inbound -->
            <div class="p-6 pt-2 bg-white">
                <div class="flex justify-between items-center text-xs text-gray-400 mb-1 font-bold tracking-wide mt-2">
                    <span>INBOUND</span>
                    <span>2026. 5. 6 (Ïàò)</span>
                </div>
                 <div class="flex justify-between items-center mb-4">
                    <div class="text-center">
                        <span class="block text-3xl font-black text-gray-800">SFO</span>
                    </div>
                    <div class="flex-1 px-4 flex flex-col items-center">
                        <i class="ph-fill ph-airplane-tilt text-blue-500 text-xl transform rotate-180"></i>
                        <span class="text-xs font-bold text-blue-600 mt-1">YP112</span>
                        <div class="w-full h-px bg-gray-200 mt-1"></div>
                    </div>
                    <div class="text-center">
                        <span class="block text-3xl font-black text-gray-800">ICN</span>
                    </div>
                </div>
                 <div class="flex justify-between text-sm">
                    <div><span class="block text-gray-400 text-xs">Depart</span><span class="font-bold text-gray-800">15:30</span></div>
                     <div class="text-right"><span class="block text-gray-400 text-xs">Arrive (+1)</span><span class="font-bold text-gray-800">20:30</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Budget Modal -->
    <div id="budget-modal" class="modal-overlay" onclick="toggleModal('budget-modal')">
        <div class="modal-card fade-in bg-gray-50" onclick="event.stopPropagation()">
            <div class="bg-emerald-600 p-6 text-white relative">
                <h3 class="text-lg font-bold">Total Budget</h3>
                <p class="text-sm opacity-90 mt-1">2Ïù∏ Í∏∞Ï§Ä ÏòàÏÉÅ Í≤ΩÎπÑ</p>
                <div class="absolute right-6 top-6 text-2xl font-bold">‚Ç© 6,320,000</div>
                <button onclick="toggleModal('budget-modal')" class="absolute top-4 right-2 text-white/80 hover:text-white">
                    <i class="ph-bold ph-x text-xl"></i>
                </button>
            </div>
            
            <div class="p-5 space-y-4">
                <!-- Paid Items -->
                <div class="bg-white p-4 rounded-xl shadow-sm border border-emerald-100">
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-xs font-bold text-emerald-600 uppercase tracking-wide">Paid (ÌôïÏ†ï ÏßÄÏ∂ú)</span>
                        <span class="font-bold text-gray-800">‚Ç© 3,570,000</span>
                    </div>
                    <div class="space-y-2 text-sm text-gray-600">
                        <div class="flex justify-between">
                            <span>‚úàÔ∏è Ìï≠Í≥µÍ∂å (2Ïù∏)</span>
                            <span>1,440,000</span>
                        </div>
                        <div class="flex justify-between">
                            <span>üè® ÏàôÏÜå (Ï†Ñ ÏùºÏ†ï)</span>
                            <span>2,130,000</span>
                        </div>
                    </div>
                </div>

                <!-- Estimated Items -->
                <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-xs font-bold text-gray-400 uppercase tracking-wide">Estimated (ÏòàÏÉÅ)</span>
                        <span class="font-bold text-gray-800">~ ‚Ç© 2,750,000</span>
                    </div>
                    <div class="space-y-2 text-sm text-gray-600">
                        <div class="flex justify-between items-center">
                            <span>üöó Î†åÌÑ∞Ïπ¥ (1/2 ÏâêÏñ¥)</span>
                            <span class="text-emerald-600 font-medium">250,000</span>
                        </div>
                        <div class="flex justify-between">
                            <span>üçî ÏãùÎπÑ/Í≤ΩÎπÑ (8Ïùº)</span>
                            <span>2,000,000</span>
                        </div>
                         <div class="flex justify-between">
                            <span>üéü Ìà¨Ïñ¥/ÏûÖÏû•Î£å</span>
                            <span>300,000</span>
                        </div>
                         <div class="flex justify-between">
                            <span>üöï Í∏∞ÌÉÄ ÍµêÌÜµ</span>
                            <span>200,000</span>
                        </div>
                    </div>
                </div>
            </div>
             <div class="bg-gray-100 p-3 text-center text-[10px] text-gray-400">
                * ÏáºÌïë ÎπÑÏö© Ï†úÏô∏ / Î†åÌÑ∞Ïπ¥ Ï£ºÏú†ÎπÑ Ìè¨Ìï® / ÌôòÏú® Î≥ÄÎèô Í∞ÄÎä•
            </div>
        </div>
    </div>

    <!-- Left Panel: Dashboard -->
    <div class="w-full lg:w-[420px] h-[45vh] lg:h-full bg-white flex flex-col shadow-2xl z-20 relative">
        
        <!-- Header -->
        <div class="px-6 py-5 bg-white border-b border-gray-100 flex-none">
            <div class="flex justify-between items-start mb-2">
                <div>
                    <div class="flex items-center gap-2 mb-1">
                        <span class="text-xs font-bold tracking-wider text-blue-600 uppercase bg-blue-50 px-2 py-1 rounded">D-Day Trip</span>
                        <span class="text-xs text-gray-400 font-medium">Apr 29 - May 6, 2026</span>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-900 leading-tight">SF & Yosemite<br>Travel Manager</h1>
                </div>
                <div class="flex gap-2">
                    <button onclick="toggleModal('budget-modal')" class="bg-emerald-500 hover:bg-emerald-600 text-white p-3 rounded-xl shadow-lg shadow-emerald-200 transition-all hover:scale-105 active:scale-95" title="View Budget">
                        <i class="ph-bold ph-wallet text-xl"></i>
                    </button>
                    <button onclick="toggleModal('flight-modal')" class="bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-xl shadow-lg shadow-blue-200 transition-all hover:scale-105 active:scale-95" title="View Flight Ticket">
                        <i class="ph-bold ph-airplane-tilt text-xl"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Day Selector (Horizontal Scroll) -->
        <div class="px-6 py-3 border-b border-gray-100 overflow-x-auto whitespace-nowrap custom-scrollbar flex-none bg-gray-50/50 backdrop-blur-sm">
            <div class="flex gap-2" id="day-buttons">
                <!-- Generated by JS -->
            </div>
        </div>

        <!-- Dynamic Content Area -->
        <div id="itinerary-content" class="flex-1 overflow-y-auto custom-scrollbar p-0 bg-gray-50">
            <!-- Content injected here -->
        </div>

        <!-- Bottom Action Bar -->
        <div class="p-4 border-t border-gray-100 bg-white flex-none flex justify-between items-center text-xs text-gray-500">
            <div class="flex items-center gap-2">
                <i class="ph-fill ph-check-circle text-green-500"></i>
                <span>Hotels & Flights Confirmed</span>
            </div>
        </div>
    </div>

    <!-- Right Panel: Map -->
    <div class="flex-1 h-[55vh] lg:h-full relative">
        <div id="map"></div>
        
        <!-- Map Overlay Controls -->
        <div class="absolute bottom-6 right-6 z-[1000] flex flex-col gap-2">
            <button onclick="resetView()" class="bg-white p-3 rounded-full shadow-lg hover:bg-gray-50 transition text-gray-700" title="Reset View">
                <i class="ph-bold ph-frame-corners text-xl"></i>
            </button>
        </div>
        
        <!-- Current Location/Context Badge -->
        <div id="map-badge" class="absolute top-6 left-6 z-[1000] bg-white/90 backdrop-blur-md px-4 py-3 rounded-xl shadow-lg border border-gray-200 hidden fade-in max-w-xs">
            <h4 class="font-bold text-gray-900 text-sm mb-1" id="badge-title">Location</h4>
            <p class="text-xs text-gray-600 leading-relaxed" id="badge-desc">Description</p>
        </div>
    </div>

    <script>
        // --- 1. Data Structure ---
        const tripData = {
            1: {
                date: "4/29 (Wed)",
                title: "Arrival & Setup",
                area: "SF Downtown",
                color: "#4B5563",
                transport: { type: "Rental Car", icon: "ph-car", detail: "Pick up at SFO (1/2 Share)" },
                tip: "Í≥µÌï≠ ÎèÑÏ∞©(13:00) ÌõÑ Î†åÌÑ∞Ïπ¥ ÌîΩÏóÖ. ÏãúÎÇ¥ Ïö¥Ï†Ñ Ï£ºÏùò!",
                points: [
                    { name: "SFO Airport", lat: 37.6213, lng: -122.3790, type: "airport", time: "13:00", desc: "YP111 ÎèÑÏ∞© & Î†åÌÑ∞Ïπ¥ ÌîΩÏóÖ" },
                    { name: "Union Square Hotel", lat: 37.7879, lng: -122.4075, type: "hotel", time: "16:00", desc: "Ï≤¥ÌÅ¨Ïù∏ (ÏûÑÏãú 1Î∞ï)" },
                    { name: "Trader Joe's / Whole Foods", lat: 37.7816, lng: -122.4010, type: "shopping", time: "19:00", desc: "ÏöîÏÑ∏ÎØ∏Ìã∞ Ïû•Î≥¥Í∏∞ (Î¨º, Í∞ÑÏãù)" }
                ]
            },
            2: {
                date: "4/30 (Thu)",
                title: "Into the Wild",
                area: "Yosemite NP",
                color: "#166534",
                transport: { type: "Driving", icon: "ph-steering-wheel", detail: "SF ‚Üí Yosemite (4h)" },
                tip: "ÌÑ∞ÎÑê Î∑∞Îäî ÏöîÏÑ∏ÎØ∏Ìã∞ ÏµúÍ≥†Ïùò Ìè¨ÌÜ†Ïä§ÌåüÏûÖÎãàÎã§. ÎÜìÏπòÏßÄ ÎßàÏÑ∏Ïöî.",
                points: [
                    { name: "SF Departure", lat: 37.7879, lng: -122.4075, type: "start", time: "08:00", desc: "Ï∂úÎ∞ú" },
                    { name: "Tunnel View", lat: 37.7157, lng: -119.6774, type: "photo", time: "14:30", desc: "ÏöîÏÑ∏ÎØ∏Ìã∞ Î∞∏Î¶¨ Ï≤´ Ï°∞Îßù" },
                    { name: "Bridalveil Fall", lat: 37.7166, lng: -119.6464, type: "nature", time: "15:30", desc: "Í∞ÄÎ≥çÍ≤å ÏÇ∞Ï±Ö" },
                    { name: "Curry Village", lat: 37.7371, lng: -119.5732, type: "hotel", time: "16:30", desc: "Ï≤¥ÌÅ¨Ïù∏ (ÌôïÏ†ï)" },
                    { name: "Cook's Meadow Loop", lat: 37.7490, lng: -119.5870, type: "walk", time: "17:30", desc: "ÌïòÌîÑÎèî Î∑∞ ÌèâÏßÄ ÏÇ∞Ï±Ö" }
                ]
            },
            3: {
                date: "5/1 (Fri)",
                title: "Waterfall Hiking",
                area: "Yosemite NP",
                color: "#15803D",
                transport: { type: "Shuttle/Walk", icon: "ph-person-simple-walk", detail: "Park car at Curry Village" },
                tip: "ÎØ∏Ïä§Ìä∏ Ìä∏Î†àÏùºÏùÄ Ïò∑Ïù¥ Ï†ñÏäµÎãàÎã§. Ïö∞ÎπÑÎÇò Î∞©Ïàò ÏûêÏºì ÌïÑÏàò!",
                points: [
                    { name: "Curry Village", lat: 37.7371, lng: -119.5732, type: "start", time: "08:30", desc: "ÌïòÏù¥ÌÇπ Ï§ÄÎπÑ & Ï∂úÎ∞ú" },
                    { name: "Mist Trailhead", lat: 37.7349, lng: -119.5662, type: "hike", time: "09:00", desc: "Vernal Fall Îì±Î∞ò ÏãúÏûë" },
                    { name: "Vernal Fall Footbridge", lat: 37.7325, lng: -119.5582, type: "nature", time: "10:30", desc: "Ìè≠Ìè¨ Í∞êÏÉÅ" },
                    { name: "Lower Yosemite Fall", lat: 37.7510, lng: -119.5960, type: "nature", time: "15:30", desc: "Î∂ÅÎØ∏ ÏµúÍ≥† ÎÜíÏù¥ Ìè≠Ìè¨" },
                    { name: "Mirror Lake", lat: 37.7480, lng: -119.5660, type: "photo", time: "17:00", desc: "Ìò∏Ïàò ÏÇ∞Ï±Ö (ÏòµÏÖò)" }
                ]
            },
            4: {
                date: "5/2 (Sat)",
                title: "Return to SF",
                area: "Transit",
                color: "#4ADE80",
                transport: { type: "Driving", icon: "ph-car", detail: "Yosemite ‚Üí SF (4.5h)" },
                tip: "SF ÎèÑÏ∞© ÌõÑ Î†åÌÑ∞Ïπ¥Î•º Î∞òÎÇ©Ìï©ÎãàÎã§. ÏãúÎÇ¥ Ï£ºÏ∞®ÎπÑÍ∞Ä Îß§Ïö∞ ÎπÑÏåâÎãàÎã§.",
                points: [
                    { name: "Curry Village", lat: 37.7371, lng: -119.5732, type: "start", time: "09:00", desc: "Ï≤¥ÌÅ¨ÏïÑÏõÉ" },
                    { name: "Valley View", lat: 37.7174, lng: -119.6617, type: "photo", time: "10:00", desc: "ÎßàÏßÄÎßâ Ìè¨ÌÜ†ÌÉÄÏûÑ" },
                    { name: "El Capitan Meadow", lat: 37.7240, lng: -119.6340, type: "photo", time: "10:30", desc: "ÏïîÎ≤Ω Îì±Î∞òÍ∞Ä Ï∞æÍ∏∞" },
                    { name: "Car Return (SF City)", lat: 37.7850, lng: -122.4080, type: "end", time: "17:00", desc: "Î†åÌÑ∞Ïπ¥ Î∞òÎÇ©" },
                    { name: "Hotel Zephyr", lat: 37.8073, lng: -122.4145, type: "hotel", time: "18:00", desc: "Ï†úÌçº Ìò∏ÌÖî Ï≤¥ÌÅ¨Ïù∏ (ÌôïÏ†ï)" }
                ]
            },
            5: {
                date: "5/3 (Sun)",
                title: "The Rock & Wharf",
                area: "SF Fisherman's Wharf",
                color: "#DC2626",
                transport: { type: "Walk/Ferry", icon: "ph-boat", detail: "Alcatraz Ferry & Cable Car" },
                tip: "ÏïåÏπ¥Ìä∏ÎùºÏ¶àÎäî ÏòàÏïΩ ÏãúÍ∞Ñ 30Î∂Ñ Ï†Ñ ÎèÑÏ∞© ÌïÑÏàò. Ïã†Î∂ÑÏ¶ù ÏßÄÏ∞∏ÌïòÏÑ∏Ïöî.",
                points: [
                    { name: "Hotel Zephyr", lat: 37.8073, lng: -122.4145, type: "start", time: "08:30", desc: "ÎèÑÎ≥¥ Ïù¥Îèô" },
                    { name: "Pier 33 (Alcatraz)", lat: 37.8066, lng: -122.4048, type: "activity", time: "09:00", desc: "ÏïåÏπ¥Ìä∏ÎùºÏ¶à Ìà¨Ïñ¥" },
                    { name: "Boudin Bakery", lat: 37.8087, lng: -122.4098, type: "food", time: "13:00", desc: "ÌÅ¥Îû®Ï∞®Ïö∞Îçî Ï†êÏã¨" },
                    { name: "Pier 39", lat: 37.8087, lng: -122.4098, type: "activity", time: "14:30", desc: "Î∞îÎã§ÏÇ¨Ïûê Íµ¨Í≤Ω" },
                    { name: "Ghirardelli Square", lat: 37.8058, lng: -122.4229, type: "food", time: "16:00", desc: "Ï¥àÏΩúÎ¶ø & ÏïÑÏù¥Ïä§ÌÅ¨Î¶º" },
                    { name: "Lombard St", lat: 37.8021, lng: -122.4187, type: "walk", time: "17:30", desc: "ÍΩÉÍ∏∏ Í±∑Í∏∞" },
                    { name: "Cable Car (Powell-Hyde)", lat: 37.8068, lng: -122.4207, type: "transport", time: "18:30", desc: "ÏºÄÏù¥Î∏îÏπ¥ ÌÉëÏäπ Ï≤¥Ìóò" }
                ]
            },
            6: {
                date: "5/4 (Mon)",
                title: "Golden Gate Biking",
                area: "SF & Sausalito",
                color: "#2563EB",
                transport: { type: "Bike/Ferry", icon: "ph-bicycle", detail: "Rent bike near Wharf" },
                tip: "ÏûêÏ†ÑÍ±∞Î°ú Îã§Î¶¨Î•º Í±¥ÎÑàÍ≥† ÏÜåÏÇ¥Î¶¨ÌÜ†ÏóêÏÑú ÌéòÎ¶¨Î°ú ÎèåÏïÑÏòµÎãàÎã§. ÌéòÎ¶¨ ÏãúÍ∞Ñ ÌôïÏù∏!",
                points: [
                    { name: "Bike Rental", lat: 37.8075, lng: -122.4150, type: "start", time: "10:00", desc: "ÏûêÏ†ÑÍ±∞ ÎåÄÏó¨" },
                    { name: "Palace of Fine Arts", lat: 37.8029, lng: -122.4484, type: "photo", time: "11:00", desc: "Î°úÎßàÏãù Í±¥Ï∂ïÎ¨º" },
                    { name: "Golden Gate Bridge", lat: 37.8199, lng: -122.4783, type: "activity", time: "12:00", desc: "Îã§Î¶¨ Ìö°Îã® (Î∞îÎûå Ï£ºÏùò)" },
                    { name: "Sausalito", lat: 37.8590, lng: -122.4852, type: "food", time: "13:30", desc: "Ï†êÏã¨ & Ìú¥Ïãù" },
                    { name: "Sausalito Ferry Terminal", lat: 37.8562, lng: -122.4787, type: "transport", time: "15:00", desc: "ÌéòÎ¶¨ ÌÉëÏäπ (To SF)" },
                    { name: "Ferry Building", lat: 37.7955, lng: -122.3937, type: "end", time: "15:30", desc: "ÎèÑÏ∞©" },
                    { name: "Twin Peaks", lat: 37.7544, lng: -122.4477, type: "photo", time: "18:30", desc: "ÏïºÍ≤Ω (Uber Ïù¥Îèô)" }
                ]
            },
            7: {
                date: "5/5 (Tue)",
                title: "Local Vibes",
                area: "Mission & Park",
                color: "#9333EA",
                transport: { type: "Uber/Lyft", icon: "ph-taxi", detail: "City exploring" },
                tip: "ÎØ∏ÏÖò ÏßÄÏó≠ÏùÄ ÌûôÌïòÏßÄÎßå Î∞§ Îä¶Í≤åÎäî Í≥®Î™©Í∏∏ÏùÑ ÌîºÌïòÏÑ∏Ïöî. ÌÉÄÎ•¥Ìã¥ÏùÄ Ï§ÑÏù¥ ÍπÅÎãàÎã§.",
                points: [
                    { name: "Alamo Square", lat: 37.7762, lng: -122.4327, type: "photo", time: "10:00", desc: "ÌéòÏù∏Ìã∞Îìú Î†àÏù¥ÎîîÏä§" },
                    { name: "Mission District", lat: 37.7598, lng: -122.4214, type: "walk", time: "11:30", desc: "Î≤ΩÌôî & ÌÉÄÎ•¥Ìã¥ Î≤†Ïù¥Ïª§Î¶¨" },
                    { name: "Dolores Park", lat: 37.7596, lng: -122.4269, type: "rest", time: "13:00", desc: "Î°úÏª¨Îì§Ïùò Ìú¥ÏãùÏ≤ò" },
                    { name: "California Academy of Sciences", lat: 37.7699, lng: -122.4661, type: "activity", time: "14:30", desc: "ÏàòÏ°±Í¥Ä & Ïó¥ÎåÄÏö∞Î¶º" },
                    { name: "Hog Island Oyster", lat: 37.7955, lng: -122.3937, type: "food", time: "18:00", desc: "ÌéòÎ¶¨ ÎπåÎî© Ï†ÄÎÖÅ (Íµ¥ & ÏôÄÏù∏)" }
                ]
            },
            8: {
                date: "5/6 (Wed)",
                title: "Departure",
                area: "SF Downtown",
                color: "#6B7280",
                transport: { type: "Uber/BART", icon: "ph-airplane-tilt", detail: "To SFO Airport" },
                tip: "ÎßàÏßÄÎßâ ÏáºÌïë ÌõÑ Í≥µÌï≠ÏúºÎ°ú. SFO Íµ≠Ï†úÏÑ†ÏùÄ 3ÏãúÍ∞Ñ Ï†Ñ ÎèÑÏ∞© Í∂åÏû•.",
                points: [
                    { name: "Hotel Zephyr", lat: 37.8073, lng: -122.4145, type: "start", time: "09:00", desc: "Ï≤¥ÌÅ¨ÏïÑÏõÉ" },
                    { name: "Blue Bottle (Sansome)", lat: 37.7915, lng: -122.4008, type: "cafe", time: "10:00", desc: "Î™®Îãù Ïª§Ìîº" },
                    { name: "Union Square", lat: 37.7879, lng: -122.4075, type: "shopping", time: "11:00", desc: "ÎßàÏßÄÎßâ ÏáºÌïë" },
                    { name: "SFO Airport", lat: 37.6213, lng: -122.3790, type: "end", time: "12:30", desc: "Í≥µÌï≠ ÎèÑÏ∞© (Ïó¨Ïú† ÏûàÍ≤å)" },
                    { name: "Flight Departure", lat: 37.6213, lng: -122.3790, type: "plane", time: "15:30", desc: "YP112 Ïù∏Ï≤úÌñâ Ï∂úÎ∞ú" }
                ]
            }
        };

        // --- 2. Map Initialization ---
        const map = L.map('map', { zoomControl: false }).setView([37.7749, -122.4194], 12);
        L.control.zoom({ position: 'bottomright' }).addTo(map);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap &copy; CARTO',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);

        let currentLayerGroup = L.layerGroup().addTo(map);
        let routePolyline = null;

        // --- 3. Render Functions ---

        function initApp() {
            renderDayButtons();
            selectDay(1); // Default to Day 1
        }

        function renderDayButtons() {
            const container = document.getElementById('day-buttons');
            container.innerHTML = Object.keys(tripData).map(day => `
                <button onclick="selectDay(${day})" id="btn-day-${day}" 
                    class="px-4 py-2 rounded-full border text-sm font-semibold transition-all duration-200 whitespace-nowrap inactive-day-btn flex flex-col items-center min-w-[60px]">
                    <span class="text-[10px] opacity-70">Day ${day}</span>
                    <span>${tripData[day].date.split(' ')[0]}</span>
                </button>
            `).join('');
        }

        function selectDay(dayId) {
            // UI Update
            document.querySelectorAll('#day-buttons button').forEach(btn => {
                btn.classList.remove('active-day-btn');
                btn.classList.add('inactive-day-btn');
            });
            const activeBtn = document.getElementById(`btn-day-${dayId}`);
            activeBtn.classList.remove('inactive-day-btn');
            activeBtn.classList.add('active-day-btn');
            activeBtn.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });

            // Data Render
            const data = tripData[dayId];
            renderContent(data, dayId);
            renderMap(data);
        }

        function renderContent(data, dayId) {
            const container = document.getElementById('itinerary-content');
            
            // Transport & Tip Card
            const infoCard = `
                <div class="px-6 py-6 fade-in">
                    <div class="bg-gradient-to-br from-white to-blue-50 border border-blue-100 rounded-2xl p-5 shadow-sm mb-6">
                        <div class="flex items-start justify-between mb-3">
                            <div>
                                <h2 class="text-xl font-bold text-gray-900">${data.title}</h2>
                                <p class="text-sm text-gray-500 flex items-center gap-1 mt-1">
                                    <i class="ph-fill ph-map-pin"></i> ${data.area}
                                </p>
                            </div>
                            <div class="bg-white p-2 rounded-lg shadow-sm text-blue-600">
                                <i class="${data.transport.icon} text-2xl"></i>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 gap-2 text-sm">
                            <div class="flex items-center gap-2 text-gray-700 bg-white/60 p-2 rounded">
                                <span class="font-semibold text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded">Ïù¥Îèô</span>
                                ${data.transport.detail}
                            </div>
                            <div class="flex items-start gap-2 text-gray-700 bg-white/60 p-2 rounded">
                                <span class="font-semibold text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded flex-none">Tip</span>
                                <span class="leading-snug">${data.tip}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Timeline -->
                    <div class="space-y-0 relative pl-4 border-l-2 border-gray-100 ml-2">
                        ${data.points.map((point, index) => `
                            <div class="mb-8 relative group cursor-pointer" onclick="focusPoint(${point.lat}, ${point.lng}, '${point.name}', '${point.desc}')">
                                <div class="absolute -left-[25px] bg-white border-2 border-${getColorName(data.color)} w-4 h-4 rounded-full mt-1.5 transition group-hover:scale-125" style="border-color: ${data.color}"></div>
                                <div class="pl-4 transition group-hover:translate-x-1">
                                    <span class="text-xs font-bold text-gray-400 font-mono mb-0.5 block">${point.time}</span>
                                    <h3 class="text-base font-bold text-gray-800">${point.name}</h3>
                                    <p class="text-sm text-gray-500 mt-0.5">${point.desc}</p>
                                    ${index < data.points.length - 1 ? 
                                        `<div class="mt-2 text-xs text-gray-300 flex flex-col gap-0.5 pl-1 border-l border-dashed border-gray-200 ml-0.5 h-4"></div>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            container.innerHTML = infoCard;
        }

        function getColorName(hex) {
            return 'blue-500'; 
        }

        function renderMap(data) {
            currentLayerGroup.clearLayers();
            if (routePolyline) {
                map.removeLayer(routePolyline);
            }

            const latlngs = [];

            data.points.forEach((point, index) => {
                const markerHtml = `
                    <div class="marker-pin" style="border-color: ${data.color}; color: ${data.color}">
                        <span class="marker-number">${index + 1}</span>
                    </div>
                `;
                
                const icon = L.divIcon({
                    className: 'custom-div-icon',
                    html: markerHtml,
                    iconSize: [30, 30],
                    iconAnchor: [15, 15]
                });

                const marker = L.marker([point.lat, point.lng], { icon: icon })
                    .bindPopup(`<div class="p-3"><b>${point.name}</b><br>${point.desc}</div>`);
                
                marker.on('click', () => {
                    showBadge(point.name, point.desc);
                });

                currentLayerGroup.addLayer(marker);
                latlngs.push([point.lat, point.lng]);
            });

            // Draw Route Line
            if (latlngs.length > 1) {
                routePolyline = L.polyline(latlngs, {
                    color: data.color,
                    weight: 4,
                    opacity: 0.7,
                    dashArray: '10, 10',
                    lineCap: 'round'
                }).addTo(map);
                map.fitBounds(routePolyline.getBounds(), { padding: [50, 50], maxZoom: 15 });
            } else if (latlngs.length === 1) {
                map.setView(latlngs[0], 14);
            }
        }

        // --- 4. Interactivity ---

        function focusPoint(lat, lng, name, desc) {
            map.flyTo([lat, lng], 16, { duration: 1.5 });
            showBadge(name, desc);
        }

        function showBadge(title, desc) {
            const badge = document.getElementById('map-badge');
            document.getElementById('badge-title').innerText = title;
            document.getElementById('badge-desc').innerText = desc;
            badge.classList.remove('hidden');
        }

        function resetView() {
            if (routePolyline) {
                map.fitBounds(routePolyline.getBounds(), { padding: [50, 50] });
            }
            document.getElementById('map-badge').classList.add('hidden');
        }

        function toggleModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal.style.display === 'flex') {
                modal.style.display = 'none';
            } else {
                modal.style.display = 'flex';
            }
        }

        // Start App
        initApp();

    </script>
</body>
</html>
