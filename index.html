<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SF & Yosemite Trip Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', 'Noto Sans KR', sans-serif; }
        
        /* Map Customization */
        #map { height: 100%; width: 100%; z-index: 0; }
        .leaflet-popup-content-wrapper { border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); padding: 0; }
        .leaflet-popup-content { margin: 0; }
        
        /* Custom Marker Styles */
        .marker-pin {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            border: 3px solid;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 8px rgba(0,0,0,0.3);
            font-weight: 700;
            font-size: 14px;
            position: relative;
            transition: transform 0.2s;
        }
        .marker-pin:hover { transform: scale(1.1); z-index: 100 !important; }
        .marker-number { color: #333; }

        /* Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* UI Animations */
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .active-day-btn { background-color: #2563EB; color: white; border-color: #2563EB; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3); }
        .inactive-day-btn { background-color: white; color: #4B5563; border-color: #E5E7EB; }
        .inactive-day-btn:hover { background-color: #F3F4F6; }
    </style>
</head>
<body class="bg-gray-50 h-screen flex flex-col lg:flex-row overflow-hidden text-gray-800">

    <!-- Left Panel: Dashboard -->
    <div class="w-full lg:w-[420px] h-[45vh] lg:h-full bg-white flex flex-col shadow-2xl z-20 relative">
        
        <!-- Header -->
        <div class="px-6 py-5 bg-white border-b border-gray-100 flex-none">
            <div class="flex justify-between items-center mb-1">
                <span class="text-xs font-bold tracking-wider text-blue-600 uppercase bg-blue-50 px-2 py-1 rounded">D-Day Trip</span>
                <span class="text-xs text-gray-400 font-medium">Apr 29 - May 6</span>
            </div>
            <h1 class="text-2xl font-bold text-gray-900 leading-tight">SF & Yosemite<br>Travel Manager</h1>
        </div>

        <!-- Day Selector (Horizontal Scroll) -->
        <div class="px-6 py-3 border-b border-gray-100 overflow-x-auto whitespace-nowrap custom-scrollbar flex-none bg-gray-50/50 backdrop-blur-sm">
            <div class="flex gap-2" id="day-buttons">
                <!-- Generated by JS -->
            </div>
        </div>

        <!-- Dynamic Content Area -->
        <div id="itinerary-content" class="flex-1 overflow-y-auto custom-scrollbar p-0 bg-gray-50">
            <!-- Content injected here -->
        </div>

        <!-- Bottom Action Bar -->
        <div class="p-4 border-t border-gray-100 bg-white flex-none flex justify-between items-center text-xs text-gray-500">
            <div class="flex items-center gap-2">
                <i class="ph-fill ph-check-circle text-green-500"></i>
                <span>All Hotels Booked</span>
            </div>
            <div class="flex items-center gap-2">
                 <i class="ph-fill ph-car text-blue-500"></i>
                <span>Car Rental Ready</span>
            </div>
        </div>
    </div>

    <!-- Right Panel: Map -->
    <div class="flex-1 h-[55vh] lg:h-full relative">
        <div id="map"></div>
        
        <!-- Map Overlay Controls -->
        <div class="absolute bottom-6 right-6 z-[1000] flex flex-col gap-2">
            <button onclick="resetView()" class="bg-white p-3 rounded-full shadow-lg hover:bg-gray-50 transition text-gray-700" title="Reset View">
                <i class="ph-bold ph-frame-corners text-xl"></i>
            </button>
        </div>
        
        <!-- Current Location/Context Badge -->
        <div id="map-badge" class="absolute top-6 left-6 z-[1000] bg-white/90 backdrop-blur-md px-4 py-3 rounded-xl shadow-lg border border-gray-200 hidden fade-in max-w-xs">
            <h4 class="font-bold text-gray-900 text-sm mb-1" id="badge-title">Location</h4>
            <p class="text-xs text-gray-600 leading-relaxed" id="badge-desc">Description</p>
        </div>
    </div>

    <script>
        // --- 1. Data Structure ---
        const tripData = {
            1: {
                date: "4/29 (Wed)",
                title: "Arrival & Setup",
                area: "SF Downtown",
                color: "#4B5563",
                transport: { type: "Rental Car", icon: "ph-car", detail: "Pick up at SFO" },
                tip: "공항에서 짐 찾고 바로 렌터카 픽업하세요. 시내 운전 주의!",
                points: [
                    { name: "SFO Airport", lat: 37.6213, lng: -122.3790, type: "airport", time: "13:00", desc: "도착 및 렌터카 픽업" },
                    { name: "Union Square Hotel", lat: 37.7879, lng: -122.4075, type: "hotel", time: "16:00", desc: "체크인 (임시 1박)" },
                    { name: "Trader Joe's / Whole Foods", lat: 37.7816, lng: -122.4010, type: "shopping", time: "19:00", desc: "요세미티 장보기 (물, 간식)" }
                ]
            },
            2: {
                date: "4/30 (Thu)",
                title: "Into the Wild",
                area: "Yosemite NP",
                color: "#166534",
                transport: { type: "Driving", icon: "ph-steering-wheel", detail: "SF → Yosemite (4h)" },
                tip: "터널 뷰는 요세미티 최고의 포토스팟입니다. 놓치지 마세요.",
                points: [
                    { name: "SF Departure", lat: 37.7879, lng: -122.4075, type: "start", time: "08:00", desc: "출발" },
                    { name: "Tunnel View", lat: 37.7157, lng: -119.6774, type: "photo", time: "14:30", desc: "요세미티 밸리 첫 조망" },
                    { name: "Bridalveil Fall", lat: 37.7166, lng: -119.6464, type: "nature", time: "15:30", desc: "가볍게 산책" },
                    { name: "Curry Village", lat: 37.7371, lng: -119.5732, type: "hotel", time: "16:30", desc: "체크인 & 짐 풀기" },
                    { name: "Cook's Meadow Loop", lat: 37.7490, lng: -119.5870, type: "walk", time: "17:30", desc: "하프돔 뷰 평지 산책" }
                ]
            },
            3: {
                date: "5/1 (Fri)",
                title: "Waterfall Hiking",
                area: "Yosemite NP",
                color: "#15803D",
                transport: { type: "Shuttle/Walk", icon: "ph-person-simple-walk", detail: "Park car at Curry Village" },
                tip: "미스트 트레일은 옷이 젖습니다. 우비나 방수 자켓 필수!",
                points: [
                    { name: "Curry Village", lat: 37.7371, lng: -119.5732, type: "start", time: "08:30", desc: "하이킹 준비 & 출발" },
                    { name: "Mist Trailhead", lat: 37.7349, lng: -119.5662, type: "hike", time: "09:00", desc: "Vernal Fall 등반 시작" },
                    { name: "Vernal Fall Footbridge", lat: 37.7325, lng: -119.5582, type: "nature", time: "10:30", desc: "폭포 감상" },
                    { name: "Lower Yosemite Fall", lat: 37.7510, lng: -119.5960, type: "nature", time: "15:30", desc: "북미 최고 높이 폭포" },
                    { name: "Mirror Lake", lat: 37.7480, lng: -119.5660, type: "photo", time: "17:00", desc: "호수 산책 (옵션)" }
                ]
            },
            4: {
                date: "5/2 (Sat)",
                title: "Return to SF",
                area: "Transit",
                color: "#4ADE80",
                transport: { type: "Driving", icon: "ph-car", detail: "Yosemite → SF (4.5h)" },
                tip: "SF 도착 후 렌터카를 반납합니다. 시내 주차비가 매우 비쌉니다.",
                points: [
                    { name: "Curry Village", lat: 37.7371, lng: -119.5732, type: "start", time: "09:00", desc: "체크아웃" },
                    { name: "Valley View", lat: 37.7174, lng: -119.6617, type: "photo", time: "10:00", desc: "마지막 포토타임" },
                    { name: "El Capitan Meadow", lat: 37.7240, lng: -119.6340, type: "photo", time: "10:30", desc: "암벽 등반가 찾기" },
                    { name: "Car Return (SF City)", lat: 37.7850, lng: -122.4080, type: "end", time: "17:00", desc: "렌터카 반납" },
                    { name: "Hotel Zephyr", lat: 37.8073, lng: -122.4145, type: "hotel", time: "18:00", desc: "메인 숙소 체크인 (워프)" }
                ]
            },
            5: {
                date: "5/3 (Sun)",
                title: "The Rock & Wharf",
                area: "SF Fisherman's Wharf",
                color: "#DC2626",
                transport: { type: "Walk/Ferry", icon: "ph-boat", detail: "Alcatraz Ferry & Cable Car" },
                tip: "알카트라즈는 예약 시간 30분 전 도착 필수. 신분증 지참하세요.",
                points: [
                    { name: "Hotel Zephyr", lat: 37.8073, lng: -122.4145, type: "start", time: "08:30", desc: "도보 이동" },
                    { name: "Pier 33 (Alcatraz)", lat: 37.8066, lng: -122.4048, type: "activity", time: "09:00", desc: "알카트라즈 투어" },
                    { name: "Boudin Bakery", lat: 37.8087, lng: -122.4098, type: "food", time: "13:00", desc: "클램차우더 점심" },
                    { name: "Pier 39", lat: 37.8087, lng: -122.4098, type: "activity", time: "14:30", desc: "바다사자 구경" },
                    { name: "Ghirardelli Square", lat: 37.8058, lng: -122.4229, type: "food", time: "16:00", desc: "초콜릿 & 아이스크림" },
                    { name: "Lombard St", lat: 37.8021, lng: -122.4187, type: "walk", time: "17:30", desc: "꽃길 걷기" },
                    { name: "Cable Car (Powell-Hyde)", lat: 37.8068, lng: -122.4207, type: "transport", time: "18:30", desc: "케이블카 탑승 체험" }
                ]
            },
            6: {
                date: "5/4 (Mon)",
                title: "Golden Gate Biking",
                area: "SF & Sausalito",
                color: "#2563EB",
                transport: { type: "Bike/Ferry", icon: "ph-bicycle", detail: "Rent bike near Wharf" },
                tip: "자전거로 다리를 건너고 소살리토에서 페리로 돌아옵니다. 페리 시간 확인!",
                points: [
                    { name: "Bike Rental", lat: 37.8075, lng: -122.4150, type: "start", time: "10:00", desc: "자전거 대여" },
                    { name: "Palace of Fine Arts", lat: 37.8029, lng: -122.4484, type: "photo", time: "11:00", desc: "로마식 건축물" },
                    { name: "Golden Gate Bridge", lat: 37.8199, lng: -122.4783, type: "activity", time: "12:00", desc: "다리 횡단 (바람 주의)" },
                    { name: "Sausalito", lat: 37.8590, lng: -122.4852, type: "food", time: "13:30", desc: "점심 & 휴식" },
                    { name: "Sausalito Ferry Terminal", lat: 37.8562, lng: -122.4787, type: "transport", time: "15:00", desc: "페리 탑승 (To SF)" },
                    { name: "Ferry Building", lat: 37.7955, lng: -122.3937, type: "end", time: "15:30", desc: "도착" },
                    { name: "Twin Peaks", lat: 37.7544, lng: -122.4477, type: "photo", time: "18:30", desc: "야경 (Uber 이동)" }
                ]
            },
            7: {
                date: "5/5 (Tue)",
                title: "Local Vibes",
                area: "Mission & Park",
                color: "#9333EA",
                transport: { type: "Uber/Lyft", icon: "ph-taxi", detail: "City exploring" },
                tip: "미션 지역은 힙하지만 밤 늦게는 골목길을 피하세요. 타르틴은 줄이 깁니다.",
                points: [
                    { name: "Alamo Square", lat: 37.7762, lng: -122.4327, type: "photo", time: "10:00", desc: "페인티드 레이디스" },
                    { name: "Mission District", lat: 37.7598, lng: -122.4214, type: "walk", time: "11:30", desc: "벽화 & 타르틴 베이커리" },
                    { name: "Dolores Park", lat: 37.7596, lng: -122.4269, type: "rest", time: "13:00", desc: "로컬들의 휴식처" },
                    { name: "California Academy of Sciences", lat: 37.7699, lng: -122.4661, type: "activity", time: "14:30", desc: "수족관 & 열대우림" },
                    { name: "Hog Island Oyster", lat: 37.7955, lng: -122.3937, type: "food", time: "18:00", desc: "페리 빌딩 저녁 (굴 & 와인)" }
                ]
            },
            8: {
                date: "5/6 (Wed)",
                title: "Departure",
                area: "SF Downtown",
                color: "#6B7280",
                transport: { type: "Uber/BART", icon: "ph-airplane-tilt", detail: "To SFO Airport" },
                tip: "마지막 쇼핑 후 공항으로. SFO 국제선은 3시간 전 도착 권장.",
                points: [
                    { name: "Hotel Zephyr", lat: 37.8073, lng: -122.4145, type: "start", time: "09:00", desc: "체크아웃" },
                    { name: "Blue Bottle (Sansome)", lat: 37.7915, lng: -122.4008, type: "cafe", time: "10:00", desc: "모닝 커피" },
                    { name: "Union Square", lat: 37.7879, lng: -122.4075, type: "shopping", time: "11:00", desc: "마지막 쇼핑" },
                    { name: "SFO Airport", lat: 37.6213, lng: -122.3790, type: "end", time: "12:45", desc: "공항 도착" }
                ]
            }
        };

        // --- 2. Map Initialization ---
        const map = L.map('map', { zoomControl: false }).setView([37.7749, -122.4194], 12);
        L.control.zoom({ position: 'bottomright' }).addTo(map);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap &copy; CARTO',
            subdomains: 'abcd',
            maxZoom: 19
        }).addTo(map);

        let currentLayerGroup = L.layerGroup().addTo(map);
        let routePolyline = null;

        // --- 3. Render Functions ---

        function initApp() {
            renderDayButtons();
            selectDay(1); // Default to Day 1
        }

        function renderDayButtons() {
            const container = document.getElementById('day-buttons');
            container.innerHTML = Object.keys(tripData).map(day => `
                <button onclick="selectDay(${day})" id="btn-day-${day}" 
                    class="px-4 py-2 rounded-full border text-sm font-semibold transition-all duration-200 whitespace-nowrap inactive-day-btn flex flex-col items-center min-w-[60px]">
                    <span class="text-[10px] opacity-70">Day ${day}</span>
                    <span>${tripData[day].date.split(' ')[0]}</span>
                </button>
            `).join('');
        }

        function selectDay(dayId) {
            // UI Update
            document.querySelectorAll('#day-buttons button').forEach(btn => {
                btn.classList.remove('active-day-btn');
                btn.classList.add('inactive-day-btn');
            });
            const activeBtn = document.getElementById(`btn-day-${dayId}`);
            activeBtn.classList.remove('inactive-day-btn');
            activeBtn.classList.add('active-day-btn');
            activeBtn.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });

            // Data Render
            const data = tripData[dayId];
            renderContent(data, dayId);
            renderMap(data);
        }

        function renderContent(data, dayId) {
            const container = document.getElementById('itinerary-content');
            
            // Transport & Tip Card
            const infoCard = `
                <div class="px-6 py-6 fade-in">
                    <div class="bg-gradient-to-br from-white to-blue-50 border border-blue-100 rounded-2xl p-5 shadow-sm mb-6">
                        <div class="flex items-start justify-between mb-3">
                            <div>
                                <h2 class="text-xl font-bold text-gray-900">${data.title}</h2>
                                <p class="text-sm text-gray-500 flex items-center gap-1 mt-1">
                                    <i class="ph-fill ph-map-pin"></i> ${data.area}
                                </p>
                            </div>
                            <div class="bg-white p-2 rounded-lg shadow-sm text-blue-600">
                                <i class="${data.transport.icon} text-2xl"></i>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 gap-2 text-sm">
                            <div class="flex items-center gap-2 text-gray-700 bg-white/60 p-2 rounded">
                                <span class="font-semibold text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded">이동</span>
                                ${data.transport.detail}
                            </div>
                            <div class="flex items-start gap-2 text-gray-700 bg-white/60 p-2 rounded">
                                <span class="font-semibold text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded flex-none">Tip</span>
                                <span class="leading-snug">${data.tip}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Timeline -->
                    <div class="space-y-0 relative pl-4 border-l-2 border-gray-100 ml-2">
                        ${data.points.map((point, index) => `
                            <div class="mb-8 relative group cursor-pointer" onclick="focusPoint(${point.lat}, ${point.lng}, '${point.name}', '${point.desc}')">
                                <div class="absolute -left-[25px] bg-white border-2 border-${getColorName(data.color)} w-4 h-4 rounded-full mt-1.5 transition group-hover:scale-125" style="border-color: ${data.color}"></div>
                                <div class="pl-4 transition group-hover:translate-x-1">
                                    <span class="text-xs font-bold text-gray-400 font-mono mb-0.5 block">${point.time}</span>
                                    <h3 class="text-base font-bold text-gray-800">${point.name}</h3>
                                    <p class="text-sm text-gray-500 mt-0.5">${point.desc}</p>
                                    ${index < data.points.length - 1 ? 
                                        `<div class="mt-2 text-xs text-gray-300 flex flex-col gap-0.5 pl-1 border-l border-dashed border-gray-200 ml-0.5 h-4"></div>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            container.innerHTML = infoCard;
        }

        function getColorName(hex) {
            // Simplified helper, strictly for CSS class mapping if needed, but mostly using inline styles for dynamic colors
            return 'blue-500'; 
        }

        function renderMap(data) {
            currentLayerGroup.clearLayers();
            if (routePolyline) {
                map.removeLayer(routePolyline);
            }

            const latlngs = [];

            data.points.forEach((point, index) => {
                const markerHtml = `
                    <div class="marker-pin" style="border-color: ${data.color}; color: ${data.color}">
                        <span class="marker-number">${index + 1}</span>
                    </div>
                `;
                
                const icon = L.divIcon({
                    className: 'custom-div-icon',
                    html: markerHtml,
                    iconSize: [30, 30],
                    iconAnchor: [15, 15]
                });

                const marker = L.marker([point.lat, point.lng], { icon: icon })
                    .bindPopup(`<div class="p-3"><b>${point.name}</b><br>${point.desc}</div>`);
                
                marker.on('click', () => {
                    showBadge(point.name, point.desc);
                });

                currentLayerGroup.addLayer(marker);
                latlngs.push([point.lat, point.lng]);
            });

            // Draw Route Line
            if (latlngs.length > 1) {
                routePolyline = L.polyline(latlngs, {
                    color: data.color,
                    weight: 4,
                    opacity: 0.7,
                    dashArray: '10, 10',
                    lineCap: 'round'
                }).addTo(map);
                
                // Add simple animation effect to line (dash offset) if desired via CSS, 
                // but Leaflet simple fitBounds is usually enough.
                map.fitBounds(routePolyline.getBounds(), { padding: [50, 50], maxZoom: 15 });
            } else if (latlngs.length === 1) {
                map.setView(latlngs[0], 14);
            }
        }

        // --- 4. Interactivity ---

        function focusPoint(lat, lng, name, desc) {
            map.flyTo([lat, lng], 16, { duration: 1.5 });
            showBadge(name, desc);
        }

        function showBadge(title, desc) {
            const badge = document.getElementById('map-badge');
            document.getElementById('badge-title').innerText = title;
            document.getElementById('badge-desc').innerText = desc;
            badge.classList.remove('hidden');
        }

        function resetView() {
            // Find current active day points and fit bounds
            if (routePolyline) {
                map.fitBounds(routePolyline.getBounds(), { padding: [50, 50] });
            }
            document.getElementById('map-badge').classList.add('hidden');
        }

        // Start App
        initApp();

    </script>
</body>
</html>
